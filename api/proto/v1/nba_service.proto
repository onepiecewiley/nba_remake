syntax = "proto3";

package v1;

option go_package = "nba_service/api/proto/v1;nba_v";

// NBA球员管理服务
service NBAService {
  // -----------------------
  // 1. 球员模块
  // -----------------------
  // 创建球员
  rpc CreatePlayer(CreatePlayerRequest) returns (PlayerResponse);

  // 获取球员详情
  rpc GetPlayer(GetPlayerRequest) returns (PlayerResponse);

  // 更新球员信息
  rpc UpdatePlayer(UpdatePlayerRequest) returns (PlayerResponse);

  // 删除球员
  rpc DeletePlayer(DeletePlayerRequest) returns (DeletePlayerResponse);

  // 按条件查询球员列表
  rpc ListPlayers(ListPlayersRequest) returns (ListPlayersResponse);

  // 按球队ID获取球员
  rpc GetPlayersByTeam(GetPlayersByTeamRequest) returns (ListPlayersResponse);

  // -----------------------
  // 2. 球队模块 (Team)
  // -----------------------
  rpc GetTeam(GetTeamRequest) returns (TeamResponse);
  rpc ListTeams(ListTeamsRequest) returns (ListTeamsResponse);

  // -----------------------
  // 3. 比赛模块 (Match)
  // -----------------------
  // 获取当天的比赛列表
  rpc ListMatches(ListMatchesRequest) returns (ListMatchesResponse);
  // 获取比赛详情 (包括实时比分)
  rpc GetMatch(GetMatchRequest) returns (MatchResponse);
  // [核心] 比赛事件上报 (对接 Kafka)
  rpc RecordMatchEvent(RecordMatchEventRequest) returns (RecordMatchEventResponse);
}

// 球员位置枚举
enum Position {
  POSITION_UNKNOWN = 0;
  PG = 1;  // 控球后卫
  SG = 2;  // 得分后卫
  SF = 3;  // 小前锋
  PF = 4;  // 大前锋
  C = 5;   // 中锋
}

// 球员状态枚举
enum PlayerStatus {
  STATUS_UNKNOWN = 0;
  RETIRED = 1;   // 退役
  ACTIVE = 2;    // 现役
  INJURED = 3;   // 受伤
  ASSIGNED = 4;  // 下放
}

// 创建球员请求
message CreatePlayerRequest {
  string name = 1;                    // 球员姓名
  int32 team_id = 2;                  // 所属球队ID
  int32 jersey_number = 3;            // 球衣号码 (1-99)
  Position position = 4;              // 位置
  double height = 5;                  // 身高 (米), 例如: 1.98
  double weight = 6;                  // 体重 (kg), 例如: 95.5
  string birthday = 7;                // 出生日期, 格式: YYYY-MM-DD
  PlayerStatus status = 8;                    // 状态
}

// 获取球员请求
message GetPlayerRequest {
  int32 id = 1;                       // 球员ID
}

// 更新球员请求
message UpdatePlayerRequest {
  int32 id = 1;                       // 球员ID
  string name = 2;                    // 球员姓名
  int32 team_id = 3;                  // 所属球队ID
  int32 jersey_number = 4;            // 球衣号码
  Position position = 5;              // 位置
  double height = 6;                  // 身高
  double weight = 7;                  // 体重
  string birthday = 8;                // 出生日期
  PlayerStatus status = 9;            // 状态
}

// 删除球员请求
message DeletePlayerRequest {
  int32 id = 1;                       // 球员ID
}

// 删除球员响应
message DeletePlayerResponse {
  bool success = 1;                   // 是否成功
  string message = 2;                 // 消息
}

// 球员响应（完整信息）
message PlayerResponse {
  int32 id = 1;                       // 球员ID
  int32 team_id = 2;                  // 所属球队ID
  string name = 3;                    // 球员姓名
  int32 jersey_number = 4;            // 球衣号码
  Position position = 5;              // 位置
  double height = 6;                  // 身高 (米)
  double weight = 7;                  // 体重 (kg)
  string birthday = 8;                // 出生日期
  PlayerStatus status = 9;            // 状态
  string status_text = 10;            // 状态文本
  string created_at = 11;             // 创建时间
  string updated_at = 12;             // 更新时间
}

// 查询球员列表请求
message ListPlayersRequest {
  int32 page = 1;                     // 页码，从1开始
  int32 page_size = 2;                // 每页数量，默认20
  string name = 3;                    // 按姓名模糊查询
  int32 team_id = 4;                  // 按球队ID查询
  Position position = 5;              // 按位置查询
  PlayerStatus status = 6;            // 按状态查询
}

// 球员列表响应
message ListPlayersResponse {
  repeated PlayerResponse players = 1;  // 球员列表
  int32 total = 2;                     // 总数量
  int32 page = 3;                      // 当前页码
  int32 page_size = 4;                 // 每页数量
}

// 按球队获取球员请求
message GetPlayersByTeamRequest {
  int32 team_id = 1;                  // 球队ID
}

// --- 球队相关 Message ---
message GetTeamRequest {
  int32 id = 1;
}

message TeamResponse {
  int32 id = 1;
  string name = 2;          // e.g. Lakers
  string city = 3;          // e.g. Los Angeles
  string abbreviation = 4;  // e.g. LAL
  string conference = 5;    // East / West
  string logo_url = 6;
}

message ListTeamsRequest {
  // 暂时留空，获取所有
}

message ListTeamsResponse {
  repeated TeamResponse teams = 1;
}

// --- 比赛相关 Message ---
message ListMatchesRequest {
  string date = 1; // 格式 "2023-11-05"
}

message MatchResponse {
  int64 id = 1;
  string date = 2;
  int32 home_team_id = 3;
  int32 visitor_team_id = 4;
  int32 home_score = 5;     // 主队得分
  int32 visitor_score = 6;  // 客队得分
  int32 status = 7;         // 0:未开始, 1:进行中, 2:已结束
  string start_time = 8;
  // 这里直接嵌套 TeamResponse，方便前端显示队名
  TeamResponse home_team = 9;
  TeamResponse visitor_team = 10;
}

message ListMatchesResponse {
  repeated MatchResponse matches = 1;
}

message GetMatchRequest {
  int64 id = 1;
}

// --- 事件上报 (Kafka 生产者用) ---
message RecordMatchEventRequest {
  int64 match_id = 1;    // 哪场比赛
  int32 player_id = 2;   // 谁
  int32 type = 3;        // 干了什么 (1:得分, 2:篮板...)
  int32 value = 4;       // 分值 (3分, 2分, 1个板)
  string event_time = 5; // 发生时间
  int32 team_id = 6;          // 属于哪个队
  int32 quarter = 7;          // 第几节 (1-4)
  string sub_type = 8;        // 子类型 (e.g. "3pt", "dunk")
  string time_remaining = 9;  // 剩余时间 (e.g. "10:23")
}

message RecordMatchEventResponse {
  bool success = 1;
  string message = 2;
}